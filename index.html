<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rhythm Chart Editor</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="sidebar">
    <div class="sidebar-controls" style="padding: 8px;">
      <label>BPM: <input id="bpm" type="number" value="120" min="1" max="999" step="0.1" /></label>
      <label>Min BPM: <input id="min-bpm" type="number" value="60" min="1" max="999" step="0.1" /></label>
      <label>Max BPM: <input id="max-bpm" type="number" value="300" min="1" max="999" step="0.1" /></label>
      <br><br>
      <label>배속: <input id="speed-multiplier" type="number" value="1.0" min="1.0" max="3.0" step="0.1" /></label>
      <label>Pre-delay (ms): <input id="pre-delay" type="number" value="3000" min="-10000" max="10000" step="100" /></label>
      <br><br>
      <label>Level: <input id="level" type="range" value="10" min="1" max="20" step="1" oninput="document.getElementById('level-display').textContent = this.value" /></label>
      <span id="level-display" style="margin-left: 5px;">10</span>
      <br><br>
      <label>Subdivisions:
        <select id="subdivisions">
          <option value="2">2분박</option>
          <option value="4">4분박</option>
          <option value="8">8분박</option>
          <option value="12">12분박</option>
          <option value="16" selected>16분박</option>
          <option value="24">24분박</option>
          <option value="32">32분박</option>
          <option value="48">48분박</option>
        </select>
      </label>
      <br><br>
      <label><input type="checkbox" id="batch-edit-toggle"> 노트 일괄 수정</label>
    </div>

    <!-- 탭 헤더 -->
    <div class="tab-header">
      <button class="tab-button active" data-tab="notes">NoteList</button>
      <button class="tab-button" data-tab="events">EventList</button>
    </div>

    <!-- 노트 리스트 탭 -->
    <div id="notes-tab" class="tab-content active">
      <div style="padding: 8px; border-bottom: 1px solid #555; background: #2a2a2a; display: flex; gap: 8px;">
        <button id="duplicate-notes" style="background: #2196F3; color: white; border: none; padding: 4px 10px; cursor: pointer; border-radius: 3px; font-size: 11px;">📋 복제</button>
        <button id="clear-note-selection" style="background: #607D8B; color: white; border: none; padding: 4px 10px; cursor: pointer; border-radius: 3px; font-size: 11px;">✖ 선택 해제</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>NO.</th>
            <th>Type</th>
            <th>Beat</th>
            <th>Time</th>
            <th>Length</th>
            <th>Direction</th>
            <th>BPM</th>
            <th>Sub</th>
            <th>Fade</th>
            <th>Wait</th>
            <th>Reset</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody id="note-list">
          <!-- script.js가 여기 <tr>을 동적으로 추가함 -->
        </tbody>
      </table>
    </div>

    <!-- 이벤트 리스트 탭 -->
    <div id="events-tab" class="tab-content">
      <div class="event-controls">
        <div class="event-controls-left">
          <button id="add-event">+ Add Event</button>
          <button id="duplicate-events">📋 복제</button>
          <button id="clear-event-selection">✖ 선택 해제</button>
          <button id="collapse-all">모두 접기</button>
          <button id="expand-all">모두 펼치기</button>
        </div>
        <div class="event-controls-right">
          <button id="go-to-url">🌐 이벤트 메뉴얼</button>
        </div>
      </div>
      <div id="event-list" class="event-list-container">
        <!-- script.js가 여기에 이벤트들을 동적으로 추가함 -->
      </div>
    </div>
  </div>

  <!-- 사이드바 리사이저 -->
  <div id="sidebar-resizer" class="sidebar-resizer"></div>

  <!-- 사이드바 토글 버튼 (사이드바 밖에 위치) -->
  <button id="sidebar-toggle" class="toggle-btn sidebar-toggle">◀</button>

  <div id="main">
    <div id="top-bar">
      <button id="save-json">Save Json</button>
      <button id="load-json">Load Json</button>
      <button id="sort-notes">Sort by Time</button>
      <button id="clear-notes">Clear All</button>
      <button id="undo-btn" title="실행 취소 (Ctrl+Z)" disabled>↶ 실행 취소</button>
      <button id="redo-btn" title="다시 실행 (Ctrl+Y)" disabled>↷ 다시 실행</button>
      <button id="export-image" title="차트를 SVG 이미지로 내보내기">Export Image</button>
      <div id="volume-controls">
        <div style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <label style="font-size: 11px; min-width: 50px;">음악:</label>
            <input type="range" id="music-volume" min="0" max="100" value="50" step="1" style="width: 100px;">
            <span id="music-volume-display" style="font-size: 11px; min-width: 30px;">50%</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <label style="font-size: 11px; min-width: 50px;">효과음:</label>
            <input type="range" id="sfx-volume" min="0" max="100" value="100" step="1" style="width: 100px;">
            <span id="sfx-volume-display" style="font-size: 11px; min-width: 30px;">100%</span>
          </div>
        </div>
      </div>
    </div>

    <div id="canvas-container">
      <canvas id="background-canvas"></canvas>
      <canvas id="canvas"></canvas>
    </div>
  </div>

  <!-- 우하단 플로팅 컨트롤 패널 -->
  <div id="control-bar">
    <!-- 컨트롤바 리사이저 -->
    <div id="control-bar-resizer" class="control-bar-resizer"></div>
    <div id="control-bar-content">
      <div id="audio-controls">
        <input type="file" id="audio-file" accept="audio/*">
        <div id="playback-controls">
          <button id="demo-pause">⏸</button>
          <button id="demo-play">▶</button>
          <button id="demo-stop">⏹</button>
        </div>
      </div>

      <div id="time-controls">
        <div id="demo-time">00:00:00 / 00:00:00</div>
        <input type="range" id="demo-seekbar" value="0" min="0" max="1000" step="1">
      </div>

      <div id="note-controls">
        <div class="note-controls-row">
          <button class="tab" id="add-tab">Tab +</button>
          <button class="dir" id="add-dir">Direction +</button>
          <button class="both" id="add-both">Both +</button>
          <button class="node" id="add-node">Node +</button>
        </div>
        <div class="note-controls-row">
          <button class="long-tab" id="add-long-tab">Long Tab +</button>
          <button class="long-dir" id="add-long-dir">Long Direction +</button>
          <button class="long-both" id="add-long-both">Long Both +</button>
        </div>
      </div>
      <div class="controls">
        <label for="camera-tracking">카메라 추적</label>
        <input type="checkbox" id="camera-tracking" checked>
        <br>
        <label for="realtime-drawing">실시간 그리기</label>
        <input type="checkbox" id="realtime-drawing" checked>
        <br>
        <label for="draw-ahead-time">그리기 시간차(초):</label>
        <input type="number" id="draw-ahead-time" value="2" min="0.1" max="10" step="0.1" style="width: 60px;">
        <br><br>
        <div id="coordinate-info" style="font-size: 11px; color: #ccc; border-top: 1px solid #555; padding-top: 8px;">
          <div><strong>좌표 정보:</strong></div>
          <div>에디터 단위/비트: <span id="editor-units-per-beat">24.0</span></div>
          <div>Unity 단위/비트: <span id="game-units-per-beat">-</span></div>
          <div>변환 비율: <span id="conversion-ratio">-</span></div>
          <br>
          <div><strong>선택된 노트 Unity 좌표:</strong></div>
          <div>X: <span id="selected-note-unity-x">-</span></div>
          <div>Y: <span id="selected-note-unity-y">-</span></div>
          <div>총 이동 거리: <span id="selected-note-total-distance">-</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 컨트롤바 토글 버튼 (컨트롤바 밖에 위치) -->
  <button id="control-bar-toggle" class="toggle-btn control-bar-toggle">×</button>


  <script src="audio-sync-module.js"></script>
  <script type="module" src="script.js"></script>
</body>

</html>